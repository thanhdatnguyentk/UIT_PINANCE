<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Place Order - {{ stock.ticker_symbol }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="logo">UIT Pinance</div>
            <nav>
                <a href="{{ url_for('dashboard') }}" class="active">Dashboard</a>
                <a href="{{ url_for('watchlist') }}">Watchlist</a>
                <a href="{{ url_for('markets')}}">Markets</a>
                <a href="{{ url_for('pending_orders')}}">Orders</a>
                <a href="{{ url_for('help_page')}}">Help</a>     
           </nav>
        </aside>

        <div class="main-content">
            <header class="topbar">
                <div class="breadcrumbs">Dashboard</div>
                <div class="topbar-right">
                    <div class="profile-menu">
                        <img
                            src="{{ url_for('static', filename='images/avatar.png') }}"
                            alt="Avatar"
                            class="avatar"
                            onclick="toggleProfileDropdown()"
                        />
                        <div id="profileDropdown" class="dropdown-content">
                            <div class="user-info">
                                <img
                                    src="{{ url_for('static', filename='images/avatar.png') }}"
                                    alt="Avatar"
                                    class="avatar-lg"
                                />
                                <div>
                                    <p class="name">{{ user.first_name }} {{ user.last_name }}</p>
                                    <p class="email">{{ user_email }}</p>
                                </div>
                            </div>
                            <a href="{{ url_for('edit_profile') }}">Chỉnh sửa hồ sơ</a>
                            <a href="{{ url_for('transactions') }}">Lịch sử giao dịch</a>
                            <a href="{{ url_for('deposit') }}">Nạp tiền</a>
                            <a href="{{ url_for('withdraw') }}">Rút tiền</a>
                            <a href="{{ url_for('logout') }}">Đăng xuất</a>
                        </div>
                    </div>
                </div>
            </header>

            <div>
                <section class ="summary-cards">
                    <div class="card">
                        <h3>Company name</h3>
                        <p>{{ company.company_name }}</p>
                    </div>
                    <div class="card">
                        <h3>Ticker Symbol</h3>
                        <p>{{ company.ticker_symbol }}</p>
                    </div>
                    <div class="card">
                        <h3>Industry</h3>
                        <p >{{ company.industry }}</p>
                    </div>
                    <div class="card">
                        <h3>Listed date</h3>
                        <p >{{ company.listed_date }}</p>
                    </div>
                    <div class="card">
                        <h3>Head quarters</h3>
                        <p >{{ company.head_quarters }}</p>
                    </div>
                    <div class="card">
                        <h3>Website</h3>
                        <p >{{ company.website }}</p>
                    </div>
                </section>
                <section class="summary-cards">
                    <div class="card">
                        <h3>Current Price</h3>
                        <p>{{ "{:,.0f}".format(latest.current_price) }}$</p>
                    </div>
                    <div class="card">
                        <h3>Bid</h3>
                        <p>{{ "{:,.0f}".format(latest.bid_price) }}$</p>
                    </div>
                    <div class="card">
                        <h3>Ask</h3>
                        <p>{{ "{:,.0f}".format(latest.ask_price) }}$</p>
                    </div>
                    <div class="card">
                        <h3>Volume</h3>
                        <p>{{ latest.volume }}</p>
                    </div>
                </section>

                <section class="chart-section">
                    <canvas id="priceChart"></canvas>
                </section>
            </div>
            
        </div>
        <form method="POST" action="{{ url_for('order_entry', stock_id=stock.stock_id) }}" class="order-panel modern"  style="display: flex; right:  100px;">
            <header class="order-panel-header">
                <h2>Place Order: {{ stock.ticker_symbol }}</h2>
              </header>
              <div class="order-panel-header">
                  <div class="leverage-toggle">
                      <button type="button" class="btn-toggle" data-leverage="cross">Cross</button>
                      <button type="button" class="btn-toggle active" data-leverage="20">20x</button>
                  </div>
                  <button type="button" class="btn-bonus">Grid Trading</button>
              </div>
              <div class="modern-tabs">
                  <button type="button" class="tab active" data-type="limit">Limit</button>
                  <button type="button" class="tab" data-type="market">Market</button>
                  <button type="button" class="tab" data-type="trailing">Trailing Stop</button>
              </div>
              <div class="modern-form">
                  <div class="input-row">
                      <div class="input-box">
                          <label style="padding: 5px;">Price (USDT)</label>
                          <input name="price" type="number" step="0.01" placeholder="0.00" required />
                      </div>
                     
                  </div>
                  <div class="input-row">
                      <div class="input-box">
                          <label style="padding: 5px;">Size </label>
                          <input name="size" type="number" step="0.01" placeholder="0.00" required />
                      </div>
                  </div>
                  <input type="hidden" name="order_type" value="limit" id="orderTypeInput" />
                  <input type="hidden" name="leverage" value="20" id="leverageInput" />
                  <div class="modern-slider"></div>
                  <div class="modern-buttons" style="padding: 5px;">
                      <button type="submit" name="side" value="buy" class="btn buy modern-buy">Buy / Long</button>
                      <button type="submit" name="side" value="sell" class="btn sell modern-sell">Sell / Short</button>
                  </div>
              </form>
    </div>

    <script>
        // Toggle profile dropdown
        function toggleProfileDropdown() {
            document.getElementById('profileDropdown').classList.toggle('show');
        }

        // Close dropdown when clicking outside
        window.onclick = function(event) {
            if (!event.target.matches('.avatar')) {
                document.querySelectorAll('.dropdown-content.show').forEach(c => c.classList.remove('show'));
            }
        };

        // Initialize Chart.js
        const labels = JSON.parse('{{ series | reverse | map(attribute="timestamp") | list | tojson | safe }}');
        const data = JSON.parse('{{ series | reverse | map(attribute="current_price") | list | tojson | safe }}');
        const ctx = document.getElementById('priceChart').getContext('2d');
        new Chart(ctx, {
            type: 'line',
            data: {
                labels,
                datasets: [{
                    label: '24h Price',
                    data,
                    fill: true,
                    tension: 0.1
                }]
            }
        });

        // TP/SL toggle logic
        const tpCheckbox = document.getElementById('tpCheckbox');
        const dualInputs = document.querySelector('.dual-inputs');
        if (tpCheckbox && dualInputs) {
            tpCheckbox.addEventListener('change', () => {
                dualInputs.style.display = tpCheckbox.checked ? 'flex' : 'none';
            });
            dualInputs.style.display = 'none'; // Initialize hidden
        }
    </script>
</body>
</html>
